<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_171) on Fri Jan 29 13:30:37 CET 2021 -->
<title>DiagnosticSnapshotService (apache-cassandra API)</title>
<meta name="date" content="2021-01-29">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="DiagnosticSnapshotService (apache-cassandra API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":9,"i2":9,"i3":10,"i4":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DiagnosticSnapshotService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/cassandra/utils/DefaultValue.html" title="class in org.apache.cassandra.utils"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../org/apache/cassandra/utils/DirectorySizeCalculator.html" title="class in org.apache.cassandra.utils"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/cassandra/utils/DiagnosticSnapshotService.html" target="_top">Frames</a></li>
<li><a href="DiagnosticSnapshotService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.apache.cassandra.utils</div>
<h2 title="Class DiagnosticSnapshotService" class="title">Class DiagnosticSnapshotService</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.cassandra.utils.DiagnosticSnapshotService</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <span class="typeNameLabel">DiagnosticSnapshotService</span>
extends java.lang.Object</pre>
<div class="block">Provides a means to take snapshots when triggered by anomalous events or when the breaking of invariants is
 detected. When debugging certain classes of problems, having access to the relevant set of sstables when the problem
 is detected (or as close to then as possible) can be invaluable.

 This class performs two functions; on a replica where an anomaly is detected, it provides methods to issue snapshot
 requests to a provided set of replicas. For instance, if rows with duplicate clusterings are detected
 (CASSANDRA-15789) during a read, a snapshot request will be issued to all participating replicas. If detected during
 compaction, only the replica itself will receive the request. Requests are issued at a maximum rate of 1 per minute
 for any given table. Any additional triggers for the same table during the 60 second window are dropped, regardless
 of the replica set. This window is configurable via a system property (cassandra.diagnostic_snapshot_interval_nanos),
 but this is intended for use in testing only and operators are not expected to override the default.

 The second function performed is to handle snapshot requests on replicas. Snapshot names are prefixed with strings
 specific to the reason which triggered them. To manage consumption of disk space, replicas are restricted to taking
 a single snapshot for each prefix in a single calendar day. So if duplicate rows are detected by multiple
 coordinators during reads with the same replica set (or overlapping sets) on the same table, the coordinators may
 each issue snapshot  requests, but the replicas will only accept the first one they receive. Further requests will
 be dropped on the replica side.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX">DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX</a></span></code>&nbsp;</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static <a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html" title="class in org.apache.cassandra.utils">DiagnosticSnapshotService</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#instance">instance</a></span></code>&nbsp;</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#duplicateRows-org.apache.cassandra.config.CFMetaData-java.lang.Iterable-">duplicateRows</a></span>(<a href="../../../../org/apache/cassandra/config/CFMetaData.html" title="class in org.apache.cassandra.config">CFMetaData</a>&nbsp;metadata,
             java.lang.Iterable&lt;java.net.InetAddress&gt;&nbsp;replicas)</code>&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>static java.lang.String</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#getSnapshotName-java.lang.String-">getSnapshotName</a></span>(java.lang.String&nbsp;prefix)</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static boolean</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#isDiagnosticSnapshotRequest-org.apache.cassandra.db.SnapshotCommand-">isDiagnosticSnapshotRequest</a></span>(<a href="../../../../org/apache/cassandra/db/SnapshotCommand.html" title="class in org.apache.cassandra.db">SnapshotCommand</a>&nbsp;command)</code>&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#shutdownAndWait-long-java.util.concurrent.TimeUnit-">shutdownAndWait</a></span>(long&nbsp;timeout,
               java.util.concurrent.TimeUnit&nbsp;unit)</code>&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>static void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html#snapshot-org.apache.cassandra.db.SnapshotCommand-java.net.InetAddress-">snapshot</a></span>(<a href="../../../../org/apache/cassandra/db/SnapshotCommand.html" title="class in org.apache.cassandra.db">SnapshotCommand</a>&nbsp;command,
        java.net.InetAddress&nbsp;initiator)</code>&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field.detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="instance">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>instance</h4>
<pre>public static final&nbsp;<a href="../../../../org/apache/cassandra/utils/DiagnosticSnapshotService.html" title="class in org.apache.cassandra.utils">DiagnosticSnapshotService</a> instance</pre>
</li>
</ul>
<a name="DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX</h4>
<pre>public static final&nbsp;java.lang.String DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX</pre>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../../../constant-values.html#org.apache.cassandra.utils.DiagnosticSnapshotService.DUPLICATE_ROWS_DETECTED_SNAPSHOT_PREFIX">Constant Field Values</a></dd>
</dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="duplicateRows-org.apache.cassandra.config.CFMetaData-java.lang.Iterable-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>duplicateRows</h4>
<pre>public static&nbsp;void&nbsp;duplicateRows(<a href="../../../../org/apache/cassandra/config/CFMetaData.html" title="class in org.apache.cassandra.config">CFMetaData</a>&nbsp;metadata,
                                 java.lang.Iterable&lt;java.net.InetAddress&gt;&nbsp;replicas)</pre>
</li>
</ul>
<a name="isDiagnosticSnapshotRequest-org.apache.cassandra.db.SnapshotCommand-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isDiagnosticSnapshotRequest</h4>
<pre>public static&nbsp;boolean&nbsp;isDiagnosticSnapshotRequest(<a href="../../../../org/apache/cassandra/db/SnapshotCommand.html" title="class in org.apache.cassandra.db">SnapshotCommand</a>&nbsp;command)</pre>
</li>
</ul>
<a name="snapshot-org.apache.cassandra.db.SnapshotCommand-java.net.InetAddress-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>snapshot</h4>
<pre>public static&nbsp;void&nbsp;snapshot(<a href="../../../../org/apache/cassandra/db/SnapshotCommand.html" title="class in org.apache.cassandra.db">SnapshotCommand</a>&nbsp;command,
                            java.net.InetAddress&nbsp;initiator)</pre>
</li>
</ul>
<a name="getSnapshotName-java.lang.String-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getSnapshotName</h4>
<pre>public static&nbsp;java.lang.String&nbsp;getSnapshotName(java.lang.String&nbsp;prefix)</pre>
</li>
</ul>
<a name="shutdownAndWait-long-java.util.concurrent.TimeUnit-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>shutdownAndWait</h4>
<pre>public&nbsp;void&nbsp;shutdownAndWait(long&nbsp;timeout,
                            java.util.concurrent.TimeUnit&nbsp;unit)
                     throws java.lang.InterruptedException,
                            java.util.concurrent.TimeoutException</pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.InterruptedException</code></dd>
<dd><code>java.util.concurrent.TimeoutException</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DiagnosticSnapshotService.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../../org/apache/cassandra/utils/DefaultValue.html" title="class in org.apache.cassandra.utils"><span class="typeNameLink">Prev&nbsp;Class</span></a></li>
<li><a href="../../../../org/apache/cassandra/utils/DirectorySizeCalculator.html" title="class in org.apache.cassandra.utils"><span class="typeNameLink">Next&nbsp;Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../../index.html?org/apache/cassandra/utils/DiagnosticSnapshotService.html" target="_top">Frames</a></li>
<li><a href="DiagnosticSnapshotService.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field.summary">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field.detail">Field</a>&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
<p class="legalCopy"><small>Copyright &copy; 2009-2019 The Apache Software Foundation</small></p>
</body>
</html>
